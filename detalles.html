<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalles de Película</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- ====== ESTILOS ====== -->
  <style>
    :root{
      --primario:#00aaff;
      --gris:#222;
      --max:960px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial, sans-serif;background:#000;color:#fff;min-height:100vh;display:flex;flex-direction:column}
    header{
      padding:12px 24px;
      background:#111;
      display:flex;align-items:center;gap:14px;
      box-shadow:0 2px 6px #000;
    }
    header a{color:#fff;text-decoration:none;font-size:24px;line-height:1}
    main{flex:1;width:100%;max-width:var(--max);margin:0 auto;padding:24px}
    .hero{
      position:relative;
      width:100%;height:320px;
      background:#333 center/cover no-repeat;
      border-radius:12px;
      overflow:hidden;
    }
    .hero::after{
      content:'';position:absolute;inset:0;
      background:linear-gradient(to top,rgba(0,0,0,.75) 10%,rgba(0,0,0,0) 60%);
    }
    .info{
      margin-top:-100px;padding:0 24px;position:relative;z-index:2;
    }
    h1{font-size:32px;margin-bottom:6px}
    .meta{display:flex;gap:16px;font-size:14px;margin-bottom:12px;color:#bbb}
    .sinopsis{line-height:1.6;margin-bottom:24px}
    .rating{
      background:var(--gris);padding:4px 10px;border-radius:12px;
      font-weight:600;color:var(--primario)
    }
    iframe,video{width:100%;height:400px;border:none;border-radius:12px}
    @media(max-width:600px){
      .hero{height:220px}
      h1{font-size:24px}
      iframe,video{height:240px}
      .info{margin-top:-60px}
    }
  </style>
</head>
<body>

<!-- ====== HEADER ====== -->
<header>
  <a href="javascript:history.back()">⟵</a>
  <span>Detalles</span>
</header>

<!-- ====== CONTENIDO ====== -->
<main>
  <div id="hero" class="hero"></div>

  <div class="info">
    <h1 id="titulo">Cargando...</h1>
    <div class="meta">
      <span id="anio"></span>
      <span class="rating" id="puntuacion"></span>
    </div>
    <p class="sinopsis" id="sinopsis"></p>
  </div>

  <section id="playerWrap" style="display:none">
    <iframe id="player" allowfullscreen></iframe>
    <!-- Si usas MP4/M3U8 pon un <video controls> y cámbialo por iframe desde JS -->
  </section>
</main>

<!-- ====== SCRIPT ====== -->
<script>
/* ---------- Config Firebase ---------- */
firebase.initializeApp({
  apiKey:"AIzaSyCmMqUkiT_8zTdJYIfhs2VneW9p_33vow4",
  authDomain:"atomix-54e1a.firebaseapp.com",
  projectId:"atomix-54e1a"
});
const db=firebase.firestore();

/* ---------- Leer parámetro titulo ---------- */
const params=new URLSearchParams(location.search);
const tituloBuscado=params.get('titulo')?decodeURIComponent(params.get('titulo')):'';

if(!tituloBuscado){
  document.getElementById('titulo').textContent='Película no encontrada';
}else{
  db.collection('peliculas').where('titulo','==',tituloBuscado).get()
    .then(snap=>{
      if(snap.empty){throw new Error('Documento no existe');}
      const p=snap.docs[0].data();

      /* ------ Pintar datos ------ */
      document.getElementById('titulo').textContent=p.titulo||'Sin título';
      document.getElementById('anio').textContent=p.anio?`Año: ${p.anio}`:'';
      document.getElementById('puntuacion').textContent=p.puntuacion?`⭐ ${p.puntuacion}/10`:'';
      document.getElementById('sinopsis').textContent=p.sinopsis||'Sinopsis no disponible.';
      document.getElementById('hero').style.backgroundImage=`url(${p.imagen})`;

      /* ------ Player ------ */
      if(p.trailer){
        const player=document.getElementById('player');
        if(p.trailer.includes('youtube.com')){
          player.src=p.trailer;
        }else{
          // Si es MP4 o M3U8 cambiamos iframe por <video>
          const wrap=document.getElementById('playerWrap');
          wrap.innerHTML=`<video controls src="${p.trailer}"></video>`;
        }
        document.getElementById('playerWrap').style.display='block';
      }
    })
    .catch(err=>{
      console.error(err);
      document.getElementById('titulo').textContent='Película no encontrada';
    });
}
</script>
</body>
</html>
