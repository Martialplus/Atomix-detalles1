<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Detalles ‚Äì Atomix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Plyr CSS y JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />
  <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.js"></script>

<style>
  :root {
    --primario: #00aaff;
    --gris: #1b1b1b;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: Arial, Helvetica, sans-serif;
    background: #000;
    color: #fff;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }

  .btn-back {
    position: fixed;
    top: 24px;
    left: 24px;
    z-index: 100;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.55);
    backdrop-filter: blur(6px);
    cursor: pointer;
    transition: 0.25s;
  }

  .btn-back:hover {
    background: var(--primario);
    transform: scale(1.05);
  }

  .btn-back svg {
    width: 24px;
    height: 24px;
    fill: #fff;
  }

  #hero {
    width: 100%;
    height: 60vh;
    min-height: 360px;
    background: center / cover no-repeat #222;
    position: relative;
    margin-bottom: 20px;
    border-radius: 20px;
    overflow: hidden;
  }

  #hero::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 15%, rgba(0, 0, 0, 0) 60%);
    pointer-events: none;
  }

  .menu-audio {
    position: absolute;
    bottom: 40px;
    left: 40px;
    display: flex;
    flex-direction: column;
    z-index: 10;
  }

  #audioBtn {
    background: rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(6px);
    border: none;
    padding: 16px 28px;
    font-size: 2rem;
    border-radius: 12px;
    color: #fff;
    cursor: pointer;
    transition: background 0.3s;
  }

  #audioBtn:hover {
    background: var(--primario);
  }

  #audioMenu {
    display: none;
    margin-top: 12px;
    background: rgba(20, 20, 20, 0.9);
    backdrop-filter: blur(6px);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
    flex-direction: column;
  }

  #audioMenu .audio-option {
    width: 100%;
    padding: 16px 28px;
    background: transparent;
    border: none;
    color: #fff;
    font-size: 1.8rem;
    text-align: left;
    cursor: pointer;
    transition: background 0.2s;
  }

  #audioMenu .audio-option:hover {
    background: var(--primario);
  }

  .info {
    width: 100%;
    max-width: 1600px;
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .titulo {
    font-size: 3.5rem;
    font-weight: 700;
    line-height: 1.2;
  }

  .meta {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    font-size: 1.5rem;
    color: #aaa;
  }

  .meta .rating {
    background: var(--primario);
    padding: 4px 16px;
    border-radius: 14px;
    color: #fff;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .meta .anio {
    background: var(--gris);
    padding: 4px 16px;
    border-radius: 14px;
    color: #aaa;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .meta .anio svg,
  .meta .rating svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
  }

  .generos {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .genero {
    background: var(--primario);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 1.2rem;
    color: #fff;
    font-weight: 600;
    border: 1px solid var(--primario);
    transition: background 0.3s;
    cursor: default;
  }

  .sinopsis {
    font-size: 1.3rem;
    line-height: 1.8;
    max-width: 100%;
    color: #ddd;
  }

  /* Modal Player */
  #modalPlayer {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }

  #modalPlayer.show {
    display: flex;
  }

  #player {
    width: 100vw !important;
    height: 100vh !important;
    background: black;
    border-radius: 0;
  }

  #closeBtn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--primario);
    border: none;
    padding: 10px 15px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    color: white;
    z-index: 10001;
    transition: background 0.3s;
  }

  #closeBtn:hover {
    background: #0088cc;
  }

  @media (max-width: 900px) {
    .titulo {
      font-size: 2.5rem;
    }

    .meta {
      font-size: 1.2rem;
    }

    .sinopsis {
      font-size: 1.1rem;
    }

    #audioBtn {
      font-size: 1.5rem;
      padding: 12px 20px;
    }

    #audioMenu .audio-option {
      font-size: 1.5rem;
      padding: 12px 20px;
    }
  }
</style>
  
</head>

<body>

<button class="btn-back" onclick="history.back()" aria-label="Volver">
  <svg viewBox="0 0 24 24">
    <path d="M15.41 16.59 10.83 12 15.41 7.41 14 6l-6 6 6 6z" />
  </svg>
</button>

<section id="hero">
  <div class="menu-audio">
    <button id="audioBtn">üéß Ver en ‚ñæ</button>
    <div id="audioMenu"></div>
  </div>
</section>

<section class="info">
  <h1 id="titulo" class="titulo">Cargando‚Ä¶</h1>

  <div class="meta">
    <time id="anio" class="anio" datetime=""></time>
    <meter id="puntuacion" class="rating" min="0" max="10" value="0">0/10</meter>
    <ul id="generos" class="generos"></ul>
  </div>

  <p id="sinopsis" class="sinopsis"></p>
</section>

<div id="modalPlayer" role="dialog" aria-modal="true" tabindex="-1">
  <button id="closeBtn" aria-label="Cerrar reproductor">‚úï Cerrar</button>
  <video id="player" playsinline controls></video>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCmMqUkiT_8zTdJYIfhs2VneW9p_33vow4",
    authDomain: "atomix-54e1a.firebaseapp.com",
    projectId: "atomix-54e1a",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const $hero = document.getElementById('hero');
  const $audioBtn = document.getElementById('audioBtn');
  const $audioMenu = document.getElementById('audioMenu');
  const $titulo = document.getElementById('titulo');
  const $anio = document.getElementById('anio');
  const $punt = document.getElementById('puntuacion');
  const $sin = document.getElementById('sinopsis');
  const $generos = document.getElementById('generos');

  const $modal = document.getElementById('modalPlayer');
  const $video = document.getElementById('player');

  let videoLatino = '';
  let videoCastellano = '';
  let videoURL = '';

  const tituloParam = new URLSearchParams(location.search).get('titulo') || '';

  if (!tituloParam) {
    $titulo.textContent = 'Pel√≠cula no encontrada';
    $audioBtn.style.display = 'none';
  } else {
    db.collection('peliculas')
      .where('titulo', '==', decodeURIComponent(tituloParam))
      .get()
      .then(snap => {
        if (snap.empty) throw new Error('No existe la pel√≠cula');
        const p = snap.docs[0].data();

        $titulo.textContent = p.titulo || 'Sin t√≠tulo';
        $sin.textContent = p.sinopsis || 'Sinopsis no disponible.';
        $hero.style.backgroundImage = `url(${p.imagen_detalle || p.imagen || ''})`;

        // A√±o (mejorado visualmente)
        $anio.innerHTML = p.anio
          ? `<div class="meta-item"><i class="icon-fecha"></i>${p.anio}</div>`
          : '';

        // Puntuaci√≥n (estilo m√°s limpio)
        $punt.innerHTML = p.puntuacion
          ? `<div class="meta-item"><i class="icon-estrella"></i>‚≠ê ${p.puntuacion}/10</div>`
          : '';

        // G√©neros como tags
        $generos.innerHTML = '';
        if (Array.isArray(p.genero) && p.genero.length > 0) {
          p.genero.forEach(g => {
            const span = document.createElement('span');
            span.className = 'genero-tag';
            span.textContent = g;
            $generos.appendChild(span);
          });
        }

        videoLatino = (p.latino || '').trim();
        videoCastellano = (p.castellano || '').trim();

        const tieneLatino = videoLatino.length > 5;
        const tieneCastellano = videoCastellano.length > 5;

        $audioMenu.innerHTML = '';

        if (tieneLatino && tieneCastellano) {
          $audioBtn.style.display = 'block';
          $audioBtn.textContent = 'üéß Ver en ‚ñæ';

          const btnLat = document.createElement('button');
          btnLat.className = 'audio-option';
          btnLat.dataset.lang = 'latino';
          btnLat.textContent = 'üîä Latino';
          $audioMenu.appendChild(btnLat);

          const btnCast = document.createElement('button');
          btnCast.className = 'audio-option';
          btnCast.dataset.lang = 'castellano';
          btnCast.textContent = 'üîä Castellano';
          $audioMenu.appendChild(btnCast);

          videoURL = videoLatino;
        } else if (tieneLatino) {
          $audioBtn.style.display = 'none';
          videoURL = videoLatino;
        } else if (tieneCastellano) {
          $audioBtn.style.display = 'none';
          videoURL = videoCastellano;
        } else {
          $audioBtn.style.display = 'none';
          videoURL = '';
        }
      })
      .catch(e => {
        console.error(e);
        $titulo.textContent = 'Pel√≠cula no encontrada';
        $audioBtn.style.display = 'none';
      });
  }

  // Men√∫ de audio
  $audioBtn.addEventListener('click', () => {
    $audioMenu.style.display = $audioMenu.style.display === 'flex' ? 'none' : 'flex';
  });

  // Selecci√≥n idioma
  $audioMenu.addEventListener('click', e => {
    if (e.target.classList.contains('audio-option')) {
      const lang = e.target.dataset.lang;
      videoURL = lang === 'latino' ? videoLatino : videoCastellano;
      $audioBtn.textContent = lang === 'latino' ? 'üéß Latino ‚ñæ' : 'üéß Castellano ‚ñæ';
      $audioMenu.style.display = 'none';
      abrirModal();
    }
  });

  // Abrir reproductor
  function abrirModal() {
    if (!videoURL) return;
    $video.src = videoURL;
    $modal.classList.add('show');
    $video.play();
  }

  // Cerrar modal
  document.getElementById('closeBtn').addEventListener('click', () => {
    $modal.classList.remove('show');
    $video.pause();
    $video.src = '';
  });

  // Cerrar con Escape
  window.addEventListener('keydown', e => {
    if (e.key === 'Escape' && $modal.classList.contains('show')) {
      $modal.classList.remove('show');
      $video.pause();
      $video.src = '';
    }
  });
</script>

</body>
</html>
