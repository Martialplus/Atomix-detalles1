<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalles – Atomix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    :root{
      --primario:#00aaff;
      --gris:#1a1a1a;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:#000;color:#fff;}

    /* ---------- Botón volver ---------- */
    .btn-back{
      position:fixed;top:24px;left:24px;z-index:50;
      width:48px;height:48px;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,.6);border:none;border-radius:50%;cursor:pointer;
      backdrop-filter:blur(6px);transition:background .25s,transform .25s;
    }
    .btn-back:hover{background:rgba(0,170,255,.8);transform:scale(1.05)}
    .btn-back svg{width:24px;height:24px;fill:#fff}

    /* ---------- Hero ---------- */
    .hero{
      width:100%;height:60vh;min-height:360px;
      background:#333 center/cover no-repeat;position:relative;
    }
    .hero::after{content:'';position:absolute;inset:0;pointer-events:none;
      background:linear-gradient(to top,rgba(0,0,0,.9) 5%,rgba(0,0,0,0) 60%)}

    /* ---------- Información ---------- */
    .info-wrapper{
      width:100%;padding:32px 5vw;display:flex;flex-direction:column;gap:24px;
    }
    .titulo{font-size:3vw;min-font-size:28px;font-weight:700}
    .meta{display:flex;gap:24px;font-size:1.2vw;min-font-size:14px;color:#aaa}
    .meta span.rating{background:var(--gris);padding:4px 14px;border-radius:14px;color:var(--primario);font-weight:600}
    .sinopsis{max-width:80vw;font-size:1.1vw;min-font-size:15px;line-height:1.6}

    /* ---------- Player ---------- */
    .player-wrapper{width:100%;padding:0 5vw 40px}
    iframe,video{width:100%;height:56.25vw;max-height:640px;border:none;border-radius:12px;background:#000}

    @media(max-width:900px){
      .titulo{font-size:28px}
      .meta{font-size:14px}
      .sinopsis{font-size:15px}
      iframe,video{height:240px}
    }
  </style>
</head>
<body>

<!-- Botón Volver -->
<button class="btn-back" onclick="history.back()" aria-label="Volver">
  <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>
</button>

<!-- Hero (imagen de fondo) -->
<section id="hero" class="hero"></section>

<!-- Información -->
<section class="info-wrapper">
  <h1 id="titulo" class="titulo">Cargando…</h1>
  <div class="meta">
    <span id="anio"></span>
    <span id="puntuacion" class="rating"></span>
  </div>
  <p id="sinopsis" class="sinopsis"></p>
</section>

<!-- Reproductor -->
<section class="player-wrapper" id="playerWrap" style="display:none">
  <iframe id="player" allowfullscreen></iframe>
</section>

<script>
  /* ----- Firebase config ----- */
  firebase.initializeApp({
    apiKey:"AIzaSyCmMqUkiT_8zTdJYIfhs2VneW9p_33vow4",
    authDomain:"atomix-54e1a.firebaseapp.com",
    projectId:"atomix-54e1a"
  });
  const db=firebase.firestore();

  /* ----- Obtener título de la URL ----- */
  const qs=new URLSearchParams(location.search);
  const titulo=qs.get('titulo')?decodeURIComponent(qs.get('titulo')):'';

  const $titulo=document.getElementById('titulo');
  const $anio=document.getElementById('anio');
  const $puntu=document.getElementById('puntuacion');
  const $sinopsis=document.getElementById('sinopsis');
  const $hero=document.getElementById('hero');
  const $player=document.getElementById('player');
  const $wrap=document.getElementById('playerWrap');

  if(!titulo){
    $titulo.textContent='Película no encontrada';
  }else{
    db.collection('peliculas').where('titulo','==',titulo).get()
      .then(snap=>{
        if(snap.empty) throw new Error('No existe');
        const p=snap.docs[0].data();
        $titulo.textContent=p.titulo||'Sin título';
        if(p.anio) $anio.textContent=`Año: ${p.anio}`;
        if(p.puntuacion) $puntu.textContent=`⭐ ${p.puntuacion}/10`;
        $sinopsis.textContent=p.sinopsis||'Sinopsis no disponible.';
        $hero.style.backgroundImage=`url(${p.imagen})`;

        if(p.trailer){
          if(/youtube\.com|youtu\.be/.test(p.trailer)){
            $player.src=p.trailer;
          }else{
            $wrap.innerHTML=`<video controls src="${p.trailer}"></video>`;
          }
          $wrap.style.display='block';
        }
      })
      .catch(err=>{
        console.warn(err);
        $titulo.textContent='Película no encontrada';
      });
  }
</script>
</body>
</html>
